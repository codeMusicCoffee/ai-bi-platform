---
description: 修复 Bug 的标准流程
---

# Bug 修复工作流

当遇到 Bug 时，必须按照以下流程进行诊断和修复，避免盲目改动导致更多问题。

## 步骤 1: Bug 定位与复现

- 明确 Bug 的表现（报错信息、异常行为、页面崩溃？）
- 确认触发条件（在什么操作下发生？）
- 检查控制台错误（浏览器 DevTools Console 或终端日志）

## 步骤 2: 代码溯源

- 找到相关的组件或 API 文件
- 使用 `grep_search` 或 `view_file_outline` 快速定位问题代码
- 检查最近的修改记录（是否在冻结区？）

## 步骤 3: 最小化修复

**关键原则**: 只修复 Bug 本身，不做任何附加优化或重构。

- 如果 Bug 在冻结区内：
  1. 先在本文档记录原因
  2. 向用户说明为什么必须修改冻结区
  3. 获得用户确认后再操作
- 如果 Bug 在非冻结区：
  1. 保留原有逻辑，仅添加修复代码
  2. 添加注释说明修复内容
  3. 示例：
     ```tsx
     // 修复：防止 undefined 导致的崩溃
     const safeValue = value ?? defaultValue;
     ```

## 步骤 4: 验证修复

// turbo-all

```bash
# 检查语法错误
pnpm run lint

# 启动开发服务器（如未启动）
pnpm dev
```

- 在浏览器中重现 Bug 触发条件
- 确认 Bug 已消失且没有引入新问题
- 检查相关功能是否正常

## 步骤 5: 更新文档（如必要）

- 如果修复涉及架构级调整，更新 `.spec/` 对应文档
- 如果修复了常见陷阱，记录到 `component-rule.md` 的"避坑指南"

## 🚫 禁止事项

- ❌ 不要在修复 Bug 时顺便"美化代码"
- ❌ 不要一次性修复多个不相关的 Bug
- ❌ 不要删除"看起来没用"的代码（可能是特殊场景的保护逻辑）
- ❌ 不要修改 UI 外观（除非 Bug 就是样式问题）
