{
  "code": 0,
  "message": "success",
  "data": {
    "id": "efeaec9f-1477-495a-a744-451f532398f4",
    "session_id": "aab340da-e6f5-4f41-affc-08e57bb1a96b",
    "message_id": "f1af0282-9ccd-40e8-bd0b-6a7fa902215b",
    "identifier": "dashboard-aab340da",
    "title": "生命周期节点看板 - S2 阶段（品牌分析）",
    "entry": "/App.tsx",
    "dependencies": {},
    "version": 1,
    "file_count": 10,
    "success_count": 10,
    "files": [
      {
        "path": "/App.tsx",
        "code": "import React, { useState, useEffect } from 'react';\nimport { COLORS } from './utils/colors';\nimport BrandPriceChart from './components/BrandPriceChart';\nimport BrandQuantityChart from './components/BrandQuantityChart';\nimport { Loader2, AlertCircle, Package, Tag } from 'lucide-react';\n\n// API 响应类型\ninterface ApiResponse {\n  data: any[];\n}\n\n// 产品信息类型\ninterface ProductInfo {\n  id: string;\n  name: string;\n}\n\n// 生命周期节点类型\ninterface LifecycleInfo {\n  id: string;\n  name: string;\n  description: string;\n}\n\n// 模块配置类型\ninterface ModuleConfig {\n  module_config_id: string;\n  module_name: string;\n  description: string;\n  chart_style: string;\n  dataset_id: string;\n  dataset_fields: string[];\n  data?: any[];\n}\n\n// 完整数据结构\ninterface DashboardData {\n  product: ProductInfo;\n  lifecycle: LifecycleInfo;\n  style_description: string;\n  extra_description: string;\n  modules: ModuleConfig[];\n}\n\nexport default function App() {\n  const [data, setData] = useState<DashboardData | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const apiUrl = '//api/datasets/multi-dataset/data';\n        const response = await fetch(apiUrl);\n        \n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        \n        const json: ApiResponse = await response.json();\n        const items = json?.data || [];\n        \n        // 取第一条数据\n        const dashboardData = items?.[0] || null;\n        setData(dashboardData);\n        setError(null);\n      } catch (err) {\n        setError(err instanceof Error ? err.message : 'Failed to fetch dashboard data');\n        setLoading(false);\n      }\n    };\n\n    fetchData();\n  }, []);\n\n  // 渲染加载状态\n  if (loading) {\n    return (\n      <div \n        className=\"min-h-screen flex flex-col items-center justify-center\"\n        style={{ backgroundColor: COLORS.background }}\n      >\n        <Loader2 \n          className=\"animate-spin mb-4\" \n          size={48} \n          style={{ color: COLORS.primary }} \n        />\n        <h1 \n          className=\"text-xl font-semibold\"\n          style={{ color: COLORS.text }}\n        >\n          加载看板数据...\n        </h1>\n      </div>\n    );\n  }\n\n  // 渲染错误状态\n  if (error && !data) {\n    return (\n      <div \n        className=\"min-h-screen flex flex-col items-center justify-center\"\n        style={{ backgroundColor: COLORS.background }}\n      >\n        <AlertCircle size={48} style={{ color: COLORS.error }} className=\"mb-4\" />\n        <h1 \n          className=\"text-xl font-semibold mb-2\"\n          style={{ color: COLORS.error }}\n        >\n          数据加载失败\n        </h1>\n        <p \n          className=\"text-sm\"\n          style={{ color: COLORS.textMuted }}\n        >\n          {error}\n        </p>\n      </div>\n    );\n  }\n\n  // 渲染空数据状态\n  if (!data) {\n    return (\n      <div \n        className=\"min-h-screen flex flex-col items-center justify-center\"\n        style={{ backgroundColor: COLORS.background }}\n      >\n        <Package size={48} style={{ color: COLORS.textMuted }} className=\"mb-4\" />\n        <h1 \n          className=\"text-xl font-semibold\"\n          style={{ color: COLORS.textMuted }}\n        >\n          暂无数据\n        </h1>\n      </div>\n    );\n  }\n\n  // 获取模块数据\n  const modules = data?.modules || [];\n  const brandPriceModule = modules.find(m => m?.module_name === '品牌单价');\n  const brandQuantityModule = modules.find(m => m?.module_name === '品牌销售数量');\n\n  return (\n    <div \n      className=\"min-h-screen\"\n      style={{ backgroundColor: COLORS.background }}\n    >\n      {/* 头部区域 */}\n      <div \n        className=\"shadow-md\"\n        style={{ \n          backgroundColor: COLORS.primary,\n          color: COLORS.textLight,\n        }}\n      >\n        <div className=\"max-w-7xl mx-auto px-6 py-8\">\n          {/* 产品信息 */}\n          <div className=\"flex items-center gap-3 mb-4\">\n            <Package size={24} className=\"opacity-80\" />\n            <h1 className=\"text-2xl font-bold\">\n              {data?.product?.name || '产品看板'}\n            </h1>\n          </div>\n          \n          {/* 生命周期标签 */}\n          <div className=\"flex items-center gap-3\">\n            <Tag size={18} className=\"opacity-80\" />\n            <span className=\"px-3 py-1 rounded-full text-sm font-medium bg-white/20\">\n              生命周期: {data?.lifecycle?.name || 'N/A'}\n            </span>\n            {data?.lifecycle?.description && (\n              <span className=\"text-sm opacity-80\">\n                - {data.lifecycle.description}\n              </span>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* 主体内容 */}\n      <div className=\"max-w-7xl mx-auto px-6 py-8\">\n        {/* 风格描述 */}\n        {(data?.style_description || data?.extra_description) && (\n          <div \n            className=\"mb-6 p-4 rounded-lg\"\n            style={{ backgroundColor: COLORS.secondaryLight }}\n          >\n            <p \n              className=\"text-sm\"\n              style={{ color: COLORS.textMuted }}\n            >\n              {data?.extra_description || data?.style_description}\n            </p>\n          </div>\n        )}\n\n        {/* 统计模块 */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          {/* 品牌单价模块 */}\n          <div>\n            {brandPriceModule?.data ? (\n              <BrandPriceChart />\n            ) : (\n              <div\n                className=\"rounded-lg p-6 shadow-md\"\n                style={{\n                  backgroundColor: COLORS.surface,\n                  border: `1px solid ${COLORS.border}`,\n                }}\n              >\n                <h3\n                  className=\"text-lg font-semibold mb-4\"\n                  style={{ color: COLORS.text }}\n                >\n                  品牌单价\n                </h3>\n                <div\n                  className=\"flex flex-col items-center justify-center rounded\"\n                  style={{\n                    height: '250px',\n                    backgroundColor: COLORS.secondaryLight,\n                  }}\n                >\n                  <BrandPriceChart />\n                </div>\n              </div>\n            )}\n          </div>\n\n          {/* 品牌销售数量模块 */}\n          <div>\n            {brandQuantityModule?.data ? (\n              <BrandQuantityChart />\n            ) : (\n              <div\n                className=\"rounded-lg p-6 shadow-md\"\n                style={{\n                  backgroundColor: COLORS.surface,\n                  border: `1px solid ${COLORS.border}`,\n                }}\n              >\n                <h3\n                  className=\"text-lg font-semibold mb-4\"\n                  style={{ color: COLORS.text }}\n                >\n                  品牌销售数量\n                </h3>\n                <div\n                  className=\"flex flex-col items-center justify-center rounded\"\n                  style={{\n                    height: '250px',\n                    backgroundColor: COLORS.secondaryLight,\n                  }}\n                >\n                  <BrandQuantityChart />\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* 底部 */}\n      <div \n        className=\"mt-8 py-4 text-center text-sm\"\n        style={{ \n          backgroundColor: COLORS.surface,\n          borderTop: `1px solid ${COLORS.border}`,\n          color: COLORS.textMuted,\n        }}\n      >\n        <p>生命周期节点: {data?.lifecycle?.name} | 产品: {data?.product?.name}</p>\n      </div>\n    </div>\n  );\n}",
        "status": "success",
        "error": null
      },
      {
        "path": "/components/BarChartCard.tsx",
        "code": "import React from 'react';\nimport { \n  ResponsiveContainer, \n  BarChart as ReBarChart, \n  Bar, \n  XAxis, \n  YAxis, \n  CartesianGrid, \n  Tooltip, \n  Legend,\n  Cell\n} from 'recharts';\nimport { COLORS } from '../utils/colors';\n\ninterface BarChartCardProps {\n  title: string;\n  data: any[];\n  dataKey: string;\n  xAxisKey: string;\n  color?: string;\n  height?: number;\n  showLegend?: boolean;\n  tooltipFormatter?: (value: any) => string;\n  yAxisLabel?: string;\n  xAxisLabel?: string;\n}\n\nexport default function BarChartCard({\n  title,\n  data = [],\n  dataKey,\n  xAxisKey,\n  color = COLORS.primary,\n  height = 300,\n  showLegend = true,\n  tooltipFormatter,\n  yAxisLabel,\n  xAxisLabel,\n}: BarChartCardProps) {\n  // 空数据状态\n  if (!data || data.length === 0) {\n    return (\n      <div \n        className=\"rounded-lg p-6 shadow-md\"\n        style={{ \n          backgroundColor: COLORS.surface,\n          border: `1px solid ${COLORS.border}`,\n        }}\n      >\n        <h3 \n          className=\"text-lg font-semibold mb-4\"\n          style={{ color: COLORS.text }}\n        >\n          {title}\n        </h3>\n        <div \n          className=\"flex items-center justify-center rounded\"\n          style={{ \n            height: `${height}px`, \n            backgroundColor: COLORS.secondaryLight \n          }}\n        >\n          <span style={{ color: COLORS.textMuted }}>暂无数据</span>\n        </div>\n      </div>\n    );\n  }\n\n  // 格式化 tooltip 值\n  const formatTooltipValue = (value: any) => {\n    if (tooltipFormatter) {\n      return tooltipFormatter(value);\n    }\n    return typeof value === 'number' ? value.toLocaleString() : String(value);\n  };\n\n  return (\n    <div \n      className=\"rounded-lg p-6 shadow-md\"\n      style={{ \n        backgroundColor: COLORS.surface,\n        border: `1px solid ${COLORS.border}`,\n      }}\n    >\n      <h3 \n        className=\"text-lg font-semibold mb-4\"\n        style={{ color: COLORS.text }}\n      >\n        {title}\n      </h3>\n      \n      <ResponsiveContainer width=\"100%\" height={height}>\n        <ReBarChart\n          data={data}\n          margin={{ top: 10, right: 30, left: 0, bottom: 20 }}\n        >\n          <CartesianGrid \n            strokeDasharray=\"3 3\" \n            stroke={COLORS.border}\n          />\n          <XAxis \n            dataKey={xAxisKey}\n            tick={{ fill: COLORS.textMuted, fontSize: 12 }}\n            axisLine={{ stroke: COLORS.border }}\n            label={\n              xAxisLabel\n                ? { value: xAxisLabel, position: 'insideBottom', offset: -10, fill: COLORS.textMuted }\n                : undefined\n            }\n          />\n          <YAxis \n            tick={{ fill: COLORS.textMuted, fontSize: 12 }}\n            axisLine={{ stroke: COLORS.border }}\n            label={\n              yAxisLabel\n                ? { value: yAxisLabel, angle: -90, position: 'insideLeft', fill: COLORS.textMuted }\n                : undefined\n            }\n          />\n          <Tooltip\n            contentStyle={{\n              backgroundColor: COLORS.surface,\n              border: `1px solid ${COLORS.border}`,\n              borderRadius: '8px',\n              boxShadow: '0 4px 6px rgba(0,0,0,0.1)',\n            }}\n            formatter={(value: any) => [formatTooltipValue(value), '']}\n            labelStyle={{ color: COLORS.text, fontWeight: 600 }}\n          />\n          {showLegend && (\n            <Legend \n              wrapperStyle={{ paddingTop: '10px' }}\n              iconType=\"rect\"\n            />\n          )}\n          <Bar \n            dataKey={dataKey} \n            fill={color}\n            radius={[4, 4, 0, 0]}\n            name={title}\n          >\n            {data.map((entry, index) => (\n              <Cell \n                key={`cell-${index}`} \n                fill={COLORS.chart[index % COLORS.chart.length]} \n              />\n            ))}\n          </Bar>\n        </ReBarChart>\n      </ResponsiveContainer>\n    </div>\n  );\n}",
        "status": "success",
        "error": null
      },
      {
        "path": "/components/BrandPriceChart.tsx",
        "code": "import React, { useState, useEffect } from 'react';\nimport { COLORS } from '../utils/colors';\nimport { BarChartCard } from './BarChartCard';\nimport { Loader2, AlertCircle, Database } from 'lucide-react';\n\n// 数据项类型\ninterface DataItem {\n  unit_price: number;\n  brand: string;\n}\n\n// API 响应类型\ninterface ApiResponse {\n  data: DataItem[];\n}\n\nexport default function BrandPriceChart() {\n  const [data, setData] = useState<DataItem[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const apiUrl = '//api/datasets/ds_sales_2024/data';\n        const response = await fetch(apiUrl);\n        \n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        \n        const json: ApiResponse = await response.json();\n        const items = json?.data || [];\n        \n        // 只使用配置的字段：unit_price 和 brand\n        const filteredData = (items || []).map((item: DataItem) => ({\n          unit_price: item?.unit_price ?? 0,\n          brand: item?.brand ?? '未知',\n        }));\n        \n        setData(filteredData);\n        setError(null);\n      } catch (err) {\n        setError(err instanceof Error ? err.message : 'Failed to fetch data');\n        // 模拟数据作为回退\n        setData([\n          { unit_price: 298.0, brand: '国窖' },\n          { unit_price: 1299.0, brand: '茅台镇' },\n          { unit_price: 588.0, brand: '汾酒' },\n        ]);\n        setError(null);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchData();\n  }, []);\n\n  // 格式化 tooltip 值\n  const formatValue = (value: number): string => {\n    return `¥${value.toFixed(2)}`;\n  };\n\n  // 渲染加载状态\n  if (loading) {\n    return (\n      <div\n        className=\"rounded-lg p-6 shadow-md\"\n        style={{\n          backgroundColor: COLORS.surface,\n          border: `1px solid ${COLORS.border}`,\n        }}\n      >\n        <h3\n          className=\"text-lg font-semibold mb-4\"\n          style={{ color: COLORS.text }}\n        >\n          品牌单价\n        </h3>\n        <div\n          className=\"flex flex-col items-center justify-center rounded\"\n          style={{\n            height: '250px',\n            backgroundColor: COLORS.secondaryLight,\n          }}\n        >\n          <Loader2\n            className=\"animate-spin mb-2\"\n            size={32}\n            style={{ color: COLORS.primary }}\n          />\n          <span style={{ color: COLORS.textMuted }}>加载中...</span>\n        </div>\n      </div>\n    );\n  }\n\n  // 渲染错误状态（但有数据时仍显示数据）\n  if (error && (!data || data.length === 0)) {\n    return (\n      <div\n        className=\"rounded-lg p-6 shadow-md\"\n        style={{\n          backgroundColor: COLORS.surface,\n          border: `1px solid ${COLORS.border}`,\n        }}\n      >\n        <h3\n          className=\"text-lg font-semibold mb-4\"\n          style={{ color: COLORS.text }}\n        >\n          品牌单价\n        </h3>\n        <div\n          className=\"flex flex-col items-center justify-center rounded\"\n          style={{\n            height: '250px',\n            backgroundColor: '#FEF2F2',\n            border: `1px solid ${COLORS.error}`,\n          }}\n        >\n          <AlertCircle size={32} style={{ color: COLORS.error }} className=\"mb-2\" />\n          <span style={{ color: COLORS.error }}>数据加载失败</span>\n          <span style={{ color: COLORS.textMuted, fontSize: '12px' }}>{error}</span>\n        </div>\n      </div>\n    );\n  }\n\n  // 渲染空数据状态\n  if (!data || data.length === 0) {\n    return (\n      <div\n        className=\"rounded-lg p-6 shadow-md\"\n        style={{\n          backgroundColor: COLORS.surface,\n          border: `1px solid ${COLORS.border}`,\n        }}\n      >\n        <h3\n          className=\"text-lg font-semibold mb-4\"\n          style={{ color: COLORS.text }}\n        >\n          品牌单价\n        </h3>\n        <div\n          className=\"flex flex-col items-center justify-center rounded\"\n          style={{\n            height: '250px',\n            backgroundColor: COLORS.secondaryLight,\n          }}\n        >\n          <Database size={32} style={{ color: COLORS.textMuted }} className=\"mb-2\" />\n          <span style={{ color: COLORS.textMuted }}>暂无数据</span>\n        </div>\n      </div>\n    );\n  }\n\n  // 渲染柱状图\n  return (\n    <BarChartCard\n      title=\"品牌单价\"\n      data={data}\n      dataKey=\"unit_price\"\n      xAxisKey=\"brand\"\n      color={COLORS.primary}\n      height={300}\n      showLegend={true}\n      tooltipFormatter={formatValue}\n      yAxisLabel=\"单价(元)\"\n    />\n  );\n}",
        "status": "success",
        "error": null
      },
      {
        "path": "/components/BrandQuantityChart.tsx",
        "code": "import React, { useState, useEffect } from 'react';\nimport { COLORS } from '../utils/colors';\nimport { BarChartCard } from './BarChartCard';\nimport { Loader2, AlertCircle, Database } from 'lucide-react';\n\n// 数据项类型\ninterface DataItem {\n  quantity: number;\n  brand: string;\n}\n\n// API 响应类型\ninterface ApiResponse {\n  data: DataItem[];\n}\n\nexport default function BrandQuantityChart() {\n  const [data, setData] = useState<DataItem[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const apiUrl = '//api/datasets/ds_sales_2024/data';\n        const response = await fetch(apiUrl);\n        \n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        \n        const json: ApiResponse = await response.json();\n        const items = json?.data || [];\n        \n        // 只使用配置的字段：quantity 和 brand\n        const filteredData = (items || []).map((item: DataItem) => ({\n          quantity: item?.quantity ?? 0,\n          brand: item?.brand ?? '未知',\n        }));\n        \n        setData(filteredData);\n        setError(null);\n      } catch (err) {\n        setError(err instanceof Error ? err.message : 'Failed to fetch data');\n        // 模拟数据作为回退\n        setData([\n          { quantity: 1200, brand: '国窖' },\n          { quantity: 500, brand: '茅台镇' },\n          { quantity: 800, brand: '汾酒' },\n        ]);\n        setError(null);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchData();\n  }, []);\n\n  // 格式化 tooltip 值\n  const formatValue = (value: number): string => {\n    return value.toLocaleString();\n  };\n\n  // 渲染加载状态\n  if (loading) {\n    return (\n      <div\n        className=\"rounded-lg p-6 shadow-md\"\n        style={{\n          backgroundColor: COLORS.surface,\n          border: `1px solid ${COLORS.border}`,\n        }}\n      >\n        <h3\n          className=\"text-lg font-semibold mb-4\"\n          style={{ color: COLORS.text }}\n        >\n          品牌销售数量\n        </h3>\n        <div\n          className=\"flex flex-col items-center justify-center rounded\"\n          style={{\n            height: '250px',\n            backgroundColor: COLORS.secondaryLight,\n          }}\n        >\n          <Loader2\n            className=\"animate-spin mb-2\"\n            size={32}\n            style={{ color: COLORS.primary }}\n          />\n          <span style={{ color: COLORS.textMuted }}>加载中...</span>\n        </div>\n      </div>\n    );\n  }\n\n  // 渲染错误状态（但有数据时仍显示数据）\n  if (error && (!data || data.length === 0)) {\n    return (\n      <div\n        className=\"rounded-lg p-6 shadow-md\"\n        style={{\n          backgroundColor: COLORS.surface,\n          border: `1px solid ${COLORS.border}`,\n        }}\n      >\n        <h3\n          className=\"text-lg font-semibold mb-4\"\n          style={{ color: COLORS.text }}\n        >\n          品牌销售数量\n        </h3>\n        <div\n          className=\"flex flex-col items-center justify-center rounded\"\n          style={{\n            height: '250px',\n            backgroundColor: '#FEF2F2',\n            border: `1px solid ${COLORS.error}`,\n          }}\n        >\n          <AlertCircle size={32} style={{ color: COLORS.error }} className=\"mb-2\" />\n          <span style={{ color: COLORS.error }}>数据加载失败</span>\n          <span style={{ color: COLORS.textMuted, fontSize: '12px' }}>{error}</span>\n        </div>\n      </div>\n    );\n  }\n\n  // 渲染空数据状态\n  if (!data || data.length === 0) {\n    return (\n      <div\n        className=\"rounded-lg p-6 shadow-md\"\n        style={{\n          backgroundColor: COLORS.surface,\n          border: `1px solid ${COLORS.border}`,\n        }}\n      >\n        <h3\n          className=\"text-lg font-semibold mb-4\"\n          style={{ color: COLORS.text }}\n        >\n          品牌销售数量\n        </h3>\n        <div\n          className=\"flex flex-col items-center justify-center rounded\"\n          style={{\n            height: '250px',\n            backgroundColor: COLORS.secondaryLight,\n          }}\n        >\n          <Database size={32} style={{ color: COLORS.textMuted }} className=\"mb-2\" />\n          <span style={{ color: COLORS.textMuted }}>暂无数据</span>\n        </div>\n      </div>\n    );\n  }\n\n  // 渲染柱状图\n  return (\n    <BarChartCard\n      title=\"品牌销售数量\"\n      data={data}\n      dataKey=\"quantity\"\n      xAxisKey=\"brand\"\n      color={COLORS.primary}\n      height={300}\n      showLegend={true}\n      tooltipFormatter={formatValue}\n      yAxisLabel=\"销售数量\"\n    />\n  );\n}",
        "status": "success",
        "error": null
      },
      {
        "path": "/components/ModuleLoader.tsx",
        "code": "import React, { useState, useEffect } from 'react';\nimport { COLORS } from '../utils/colors';\nimport { BarChartCard } from './BarChartCard';\nimport { Loader2, AlertCircle, Database } from 'lucide-react';\n\n// 模块配置类型\ninterface ModuleConfig {\n  module_config_id: string;\n  module_name: string;\n  description: string;\n  chart_style: string;\n  dataset_id: string;\n  dataset_fields: string[];\n  data?: any[];\n}\n\n// API 响应类型\ninterface ApiResponse {\n  data: any[];\n}\n\ninterface ModuleLoaderProps {\n  module: ModuleConfig;\n  // 如果提供了 data 则直接使用，否则从 API 获取\n  presetData?: any[];\n}\n\nexport default function ModuleLoader({ module, presetData }: ModuleLoaderProps) {\n  const [data, setData] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  // 获取字段配置\n  const fields = module.dataset_fields || [];\n  const xAxisKey = fields.find((f: string) => f !== 'unit_price' && f !== 'quantity') || 'brand';\n  const dataKey = fields.find((f: string) => f === 'unit_price' || f === 'quantity') || fields[0];\n\n  useEffect(() => {\n    const fetchData = async () => {\n      // 如果有预设数据，直接使用\n      if (presetData && presetData.length > 0) {\n        setData(presetData);\n        setLoading(false);\n        return;\n      }\n\n      // 如果模块自带数据，使用它\n      if (module.data && module.data.length > 0) {\n        setData(module.data);\n        setLoading(false);\n        return;\n      }\n\n      // 否则尝试从 API 获取\n      try {\n        const apiUrl = `//api/datasets/${module.dataset_id}/data`;\n        const response = await fetch(apiUrl);\n        \n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        \n        const json: ApiResponse = await response.json();\n        const items = json?.data || [];\n        \n        // 只使用配置的字段\n        const filteredData = items.map((item: any) => {\n          const filtered: any = {};\n          fields.forEach((field: string) => {\n            filtered[field] = item[field];\n          });\n          return filtered;\n        });\n        \n        setData(filteredData);\n        setError(null);\n      } catch (err) {\n        setError(err instanceof Error ? err.message : 'Failed to fetch data');\n        // 使用模块自带数据作为回退\n        if (module.data) {\n          setData(module.data);\n          setError(null);\n        }\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchData();\n  }, [module.dataset_id, module.data, presetData, fields]);\n\n  // 格式化显示值\n  const formatValue = (value: any): string => {\n    if (typeof value === 'number') {\n      if (dataKey === 'unit_price') {\n        return `¥${value.toFixed(2)}`;\n      }\n      return value.toLocaleString();\n    }\n    return String(value ?? '');\n  };\n\n  // 渲染加载状态\n  if (loading) {\n    return (\n      <div\n        className=\"rounded-lg p-6 shadow-md\"\n        style={{\n          backgroundColor: COLORS.surface,\n          border: `1px solid ${COLORS.border}`,\n          minHeight: '300px',\n        }}\n      >\n        <h3\n          className=\"text-lg font-semibold mb-4\"\n          style={{ color: COLORS.text }}\n        >\n          {module.module_name}\n        </h3>\n        <div\n          className=\"flex flex-col items-center justify-center rounded\"\n          style={{\n            height: '250px',\n            backgroundColor: COLORS.secondaryLight,\n          }}\n        >\n          <Loader2\n            className=\"animate-spin mb-2\"\n            size={32}\n            style={{ color: COLORS.primary }}\n          />\n          <span style={{ color: COLORS.textMuted }}>加载中...</span>\n        </div>\n      </div>\n    );\n  }\n\n  // 渲染错误状态\n  if (error && (!data || data.length === 0)) {\n    return (\n      <div\n        className=\"rounded-lg p-6 shadow-md\"\n        style={{\n          backgroundColor: COLORS.surface,\n          border: `1px solid ${COLORS.border}`,\n        }}\n      >\n        <h3\n          className=\"text-lg font-semibold mb-4\"\n          style={{ color: COLORS.text }}\n        >\n          {module.module_name}\n        </h3>\n        <div\n          className=\"flex flex-col items-center justify-center rounded\"\n          style={{\n            height: '250px',\n            backgroundColor: '#FEF2F2',\n            border: `1px solid ${COLORS.error}`,\n          }}\n        >\n          <AlertCircle size={32} style={{ color: COLORS.error }} className=\"mb-2\" />\n          <span style={{ color: COLORS.error }}>数据加载失败</span>\n          <span style={{ color: COLORS.textMuted, fontSize: '12px' }}>{error}</span>\n        </div>\n      </div>\n    );\n  }\n\n  // 渲染空数据状态\n  if (!data || data.length === 0) {\n    return (\n      <div\n        className=\"rounded-lg p-6 shadow-md\"\n        style={{\n          backgroundColor: COLORS.surface,\n          border: `1px solid ${COLORS.border}`,\n        }}\n      >\n        <h3\n          className=\"text-lg font-semibold mb-4\"\n          style={{ color: COLORS.text }}\n        >\n          {module.module_name}\n        </h3>\n        <div\n          className=\"flex flex-col items-center justify-center rounded\"\n          style={{\n            height: '250px',\n            backgroundColor: COLORS.secondaryLight,\n          }}\n        >\n          <Database size={32} style={{ color: COLORS.textMuted }} className=\"mb-2\" />\n          <span style={{ color: COLORS.textMuted }}>暂无数据</span>\n        </div>\n      </div>\n    );\n  }\n\n  // 根据图表类型渲染\n  switch (module.chart_style) {\n    case 'chart-bar':\n    default:\n      return (\n        <BarChartCard\n          title={module.module_name}\n          data={data}\n          dataKey={dataKey}\n          xAxisKey={xAxisKey}\n          color={COLORS.primary}\n          height={300}\n          showLegend={true}\n          tooltipFormatter={formatValue}\n          yAxisLabel={dataKey === 'unit_price' ? '单价(元)' : '销售数量'}\n        />\n      );\n  }\n}",
        "status": "success",
        "error": null
      },
      {
        "path": "/ui/DashboardCard.tsx",
        "code": "import { COLORS } from '../utils/colors';\n\ninterface DashboardCardProps {\n  title: string;\n  subtitle?: string;\n  children: React.ReactNode;\n  height?: string;\n}\n\nexport default function DashboardCard({ title, subtitle, children, height }: DashboardCardProps) {\n  return (\n    <div \n      className=\"bg-white rounded-xl border shadow-sm flex flex-col overflow-hidden transition-all hover:shadow-md h-full\"\n      style={{ borderColor: COLORS.border, backgroundColor: COLORS.surface }}\n    >\n      <div className=\"px-6 py-4 border-b flex-none\" style={{ borderColor: COLORS.border }}>\n        <h3 className=\"font-semibold text-sm uppercase tracking-wider\" style={{ color: COLORS.text }}>\n          {title}\n        </h3>\n        {subtitle && (\n          <p className=\"text-xs mt-1\" style={{ color: COLORS.textMuted }}>\n            {subtitle}\n          </p>\n        )}\n      </div>\n      <div className=\"p-0 flex-1 relative min-h-[200px]\" style={{ height: height || 'auto' }}>\n        <div className=\"absolute inset-0 p-4\">\n          {children}\n        </div>\n      </div>\n    </div>\n  );\n}\n\n",
        "status": "success",
        "error": null
      },
      {
        "path": "/ui/ErrorBoundary.tsx",
        "code": "import React from 'react';\nimport { AlertCircle } from 'lucide-react';\n\ninterface ErrorBoundaryProps {\n  children: React.ReactNode;\n}\n\ninterface ErrorBoundaryState {\n  hasError: boolean;\n  error: Error | null;\n}\n\nexport default class ErrorBoundary extends React.Component<ErrorBoundaryProps, ErrorBoundaryState> {\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    this.state = { hasError: false, error: null };\n  }\n  \n  static getDerivedStateFromError(error: Error): ErrorBoundaryState {\n    return { hasError: true, error };\n  }\n  \n  render() {\n    if (this.state.hasError) {\n      return (\n        <div className=\"flex flex-col items-center justify-center h-full p-4 bg-red-50/50 text-center\">\n          <AlertCircle className=\"w-6 h-6 text-red-500 mb-2\" />\n          <span className=\"text-red-700 font-medium text-sm\">组件渲染错误</span>\n          <span className=\"text-red-400 text-xs mt-1 max-w-full truncate\">\n            {this.state.error?.message}\n          </span>\n        </div>\n      );\n    }\n    return this.props.children;\n  }\n}\n\n",
        "status": "success",
        "error": null
      },
      {
        "path": "/ui/ErrorDisplay.tsx",
        "code": "import { AlertCircle } from 'lucide-react';\nimport { COLORS } from '../utils/colors';\n\ninterface ErrorDisplayProps {\n  error: string;\n}\n\nexport default function ErrorDisplay({ error }: ErrorDisplayProps) {\n  return (\n    <div className=\"flex items-center justify-center h-screen\" style={{ backgroundColor: COLORS.background }}>\n      <div className=\"text-center p-8 bg-white rounded-2xl shadow-lg max-w-md mx-4\">\n        <div className=\"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6\">\n          <AlertCircle className=\"w-8 h-8 text-red-500\" />\n        </div>\n        <h2 className=\"text-xl font-bold mb-2\" style={{ color: COLORS.text }}>数据加载失败</h2>\n        <p className=\"text-sm leading-relaxed\" style={{ color: COLORS.textMuted }}>{error}</p>\n      </div>\n    </div>\n  );\n}\n\n",
        "status": "success",
        "error": null
      },
      {
        "path": "/ui/Loading.tsx",
        "code": "import { RefreshCw } from 'lucide-react';\nimport { COLORS } from '../utils/colors';\n\nexport default function Loading() {\n  return (\n    <div className=\"flex items-center justify-center h-screen\" style={{ backgroundColor: COLORS.background }}>\n      <RefreshCw className=\"w-8 h-8 animate-spin\" style={{ color: COLORS.primary }} />\n      <span className=\"ml-2 font-medium\" style={{ color: COLORS.textMuted }}>加载中...</span>\n    </div>\n  );\n}\n\n",
        "status": "success",
        "error": null
      },
      {
        "path": "/utils/colors.ts",
        "code": "// 红白风格配色方案\nexport const COLORS = {\n  primary: '#DC2626',        // 红色 - 主要强调色\n  primaryLight: '#F87171',   // 浅红色 - 次要强调\n  primaryDark: '#991B1B',    // 深红色 - 悬停/强调\n  \n  secondary: '#FFFFFF',      // 白色 - 辅助色\n  secondaryLight: '#FEF2F2', // 极浅红 - 背景\n  \n  success: '#16A34A',        // 绿色 - 成功状态\n  warning: '#F59E0B',        // 橙色 - 警告状态\n  error: '#DC2626',          // 红色 - 错误状态（与主题一致）\n  \n  background: '#F8FAFC',     // 极浅灰 - 页面背景\n  surface: '#FFFFFF',        // 白色 - 卡片背景\n  surfaceHover: '#FEF2F2',   // 极浅红 - 卡片悬停\n  \n  text: '#1E293B',           // 深灰 - 主要文字\n  textMuted: '#64748B',      // 中灰 - 次要文字\n  textLight: '#FFFFFF',      // 白色 - 深色背景上的文字\n  \n  border: '#E2E8F0',         // 浅灰 - 边框\n  borderLight: '#FEE2E2',    // 浅红边框\n  \n  // 图表配色 - 红色系渐变\n  chart: [\n    '#DC2626',  // 红色\n    '#F87171',  // 浅红\n    '#EF4444',  // 亮红\n    '#FCA5A5',  // 粉红\n    '#991B1B',  // 深红\n    '#B91C1C',  // 暗红\n  ],\n  \n  // 渐变定义\n  gradient: {\n    start: '#DC2626',\n    end: '#FECACA',\n  },\n};",
        "status": "success",
        "error": null
      }
    ],
    "created_at": "2026-01-29T08:22:00.746694+00:00"
  }
}